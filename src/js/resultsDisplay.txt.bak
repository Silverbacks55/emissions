// resultsDisplay.js - Display calculation results

function calculateAndShowResults(formData) {
  console.log('Calculating results...');

  // Run calculation
  const results = calculateFootprint(formData, EMISSION_FACTORS);
  
  console.log('Results:', results);
  
  // Hide form wizard
  document.getElementById('form-wizard').classList.add('hidden');
  
  // Show results page
  showResultsPage(results, formData);
}

function showResultsPage(results, formData) {
  // Create results container
  const resultsHTML = `
    <div id="results-page" class="page-container">
      <div style="background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 30px;">
        <h1 style="color: #2d5016; margin-bottom: 20px;">Your Carbon Footprint Results</h1>
        
        <div style="background: #f8f9fa; padding: 30px; border-radius: 8px; margin-bottom: 30px;">
          <h2 style="font-size: 3rem; color: #2d5016; margin: 0;">${results.summary.total.toLocaleString()} tCO₂e</h2>
          <p style="color: #6c757d; margin: 10px 0 0 0;">Total Annual Emissions</p>
        </div>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
          <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
            <h3 style="color: #2d5016; font-size: 1.5rem; margin: 0;">${results.summary.scope1.toLocaleString()}</h3>
            <p style="color: #6c757d; margin: 5px 0 0 0;">Scope 1 (${((results.summary.scope1/results.summary.total)*100).toFixed(0)}%)</p>
            <p style="font-size: 0.875rem; color: #6c757d;">Direct emissions</p>
          </div>
          
          <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
            <h3 style="color: #2d5016; font-size: 1.5rem; margin: 0;">${results.summary.scope2.toLocaleString()}</h3>
            <p style="color: #6c757d; margin: 5px 0 0 0;">Scope 2 (${((results.summary.scope2/results.summary.total)*100).toFixed(0)}%)</p>
            <p style="font-size: 0.875rem; color: #6c757d;">Purchased electricity</p>
          </div>
          
          <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
            <h3 style="color: #2d5016; font-size: 1.5rem; margin: 0;">${results.summary.scope3.toLocaleString()}</h3>
            <p style="color: #6c757d; margin: 5px 0 0 0;">Scope 3 (${((results.summary.scope3/results.summary.total)*100).toFixed(0)}%)</p>
            <p style="font-size: 0.875rem; color: #6c757d;">Value chain</p>
          </div>
        </div>
        
        <h3 style="color: #2d5016; margin-top: 30px; margin-bottom: 15px;">Intensity Metrics</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
          <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
            <p style="color: #6c757d; margin: 0;">Per Employee</p>
            <h3 style="color: #2d5016; margin: 5px 0 0 0;">${results.intensityMetrics.perEmployee.toFixed(2)} tCO₂e</h3>
          </div>
          <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
            <p style="color: #6c757d; margin: 0;">Per $M Revenue</p>
            <h3 style="color: #2d5016; margin: 5px 0 0 0;">${results.intensityMetrics.perRevenue.toLocaleString()} tCO₂e</h3>
          </div>
        </div>
        
<h3 style="color: #2d5016; margin-top: 30px; margin-bottom: 15px;">Scope 3 Breakdown by Category</h3>
        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
          <table style="width: 100%; border-collapse: collapse;">
            <tr style="border-bottom: 2px solid #2d5016;">
              <th style="text-align: left; padding: 10px; color: #2d5016;">Category</th>
              <th style="text-align: right; padding: 10px; color: #2d5016;">Emissions (tCO₂e)</th>
              <th style="text-align: right; padding: 10px; color: #2d5016;">% of Scope 3</th>
            </tr>
            <tr style="border-bottom: 1px solid #e9ecef;">
              <td style="padding: 10px;">Cat 1: Purchased Goods & Services</td>
              <td style="text-align: right; padding: 10px;">${results.breakdown.scope3.purchasedGoods.toLocaleString()}</td>
              <td style="text-align: right; padding: 10px;">${((results.breakdown.scope3.purchasedGoods/results.summary.scope3)*100).toLocaleString()}%</td>
            </tr>
            <tr style="border-bottom: 1px solid #e9ecef;">
              <td style="padding: 10px;">Cat 2: Capital Goods</td>
              <td style="text-align: right; padding: 10px;">${results.breakdown.scope3.capitalGoods.toLocaleString()}</td>
              <td style="text-align: right; padding: 10px;">${((results.breakdown.scope3.capitalGoods/results.summary.scope3)*100).toLocaleString()}%</td>
            </tr>
            <tr style="border-bottom: 1px solid #e9ecef;">
              <td style="padding: 10px;">Cat 3: Fuel & Energy Related</td>
              <td style="text-align: right; padding: 10px;">${results.breakdown.scope3.fuelEnergy.toLocaleString()}</td>
              <td style="text-align: right; padding: 10px;">${((results.breakdown.scope3.fuelEnergy/results.summary.scope3)*100).toLocaleString()}%</td>
            </tr>
            <tr style="border-bottom: 1px solid #e9ecef;">
              <td style="padding: 10px;">Cat 4: Upstream Transport</td>
              <td style="text-align: right; padding: 10px;">${results.breakdown.scope3.upstreamTransport.toLocaleString()}</td>
              <td style="text-align: right; padding: 10px;">${((results.breakdown.scope3.upstreamTransport/results.summary.scope3)*100).toLocaleString()}%</td>
            </tr>
            <tr style="border-bottom: 1px solid #e9ecef;">
              <td style="padding: 10px;">Cat 5: Waste</td>
              <td style="text-align: right; padding: 10px;">${results.breakdown.scope3.waste.toLocaleString()}</td>
              <td style="text-align: right; padding: 10px;">${((results.breakdown.scope3.waste/results.summary.scope3)*100).toLocaleString()}%</td>
            </tr>
            <tr style="border-bottom: 1px solid #e9ecef;">
              <td style="padding: 10px;">Cat 6: Business Travel</td>
              <td style="text-align: right; padding: 10px;">${results.breakdown.scope3.businessTravel.toLocaleString()}</td>
              <td style="text-align: right; padding: 10px;">${((results.breakdown.scope3.businessTravel/results.summary.scope3)*100).toLocaleString()}%</td>
            </tr>
            <tr style="border-bottom: 1px solid #e9ecef;">
              <td style="padding: 10px;">Cat 7: Employee Commuting</td>
              <td style="text-align: right; padding: 10px;">${results.breakdown.scope3.commuting.toLocaleString()}</td>
              <td style="text-align: right; padding: 10px;">${((results.breakdown.scope3.commuting/results.summary.scope3)*100).toLocaleString()}%</td>
            </tr>
            <tr style="border-bottom: 1px solid #e9ecef;">
              <td style="padding: 10px;">Cat 9: Downstream Transport</td>
              <td style="text-align: right; padding: 10px;">${results.breakdown.scope3.downstreamTransport.toLocaleString()}</td>
              <td style="text-align: right; padding: 10px;">${((results.breakdown.scope3.downstreamTransport/results.summary.scope3)*100).toLocaleString()}%</td>
            </tr>
            <tr style="border-bottom: 1px solid #e9ecef;">
              <td style="padding: 10px;">Cat 11: Use of Sold Products</td>
              <td style="text-align: right; padding: 10px;">${results.breakdown.scope3.useOfProducts.toLocaleString()}</td>
              <td style="text-align: right; padding: 10px;">${((results.breakdown.scope3.useOfProducts/results.summary.scope3)*100).toLocaleString()}%</td>
            </tr>
            <tr style="border-bottom: 1px solid #e9ecef;">
              <td style="padding: 10px;">Cat 12: End-of-Life</td>
              <td style="text-align: right; padding: 10px;">${results.breakdown.scope3.endOfLife.toLocaleString()}</td>
              <td style="text-align: right; padding: 10px;">${((results.breakdown.scope3.endOfLife/results.summary.scope3)*100).toLocaleString()}%</td>
            </tr>
            <tr style="border-bottom: 1px solid #e9ecef;">
              <td style="padding: 10px;">Cat 15: Investments</td>
              <td style="text-align: right; padding: 10px;">${results.breakdown.scope3.investments.toLocaleString()}</td>
              <td style="text-align: right; padding: 10px;">${((results.breakdown.scope3.investments/results.summary.scope3)*100).toLocaleString()}%</td>
            </tr>
          </table>
        </div>

        <h3 style="color: #2d5016; margin-top: 30px; margin-bottom: 15px;">Industry Comparison</h3>
        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
          <p><strong>Your Company:</strong> ${results.industryComparison.companyTotal} tCO₂e</p>
          <p><strong>Industry Average:</strong> ${results.industryComparison.industryAverage} tCO₂e</p>
          <p><strong>Variance:</strong> ${results.industryComparison.variance.toLocaleString()}% (${results.industryComparison.interpretation})</p>
        </div>
        
        <h3 style="color: #2d5016; margin-top: 30px; margin-bottom: 15px;">Confidence Level</h3>
        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
          <p><strong>${results.confidence.level}</strong> (${results.confidence.score}%)</p>
          <p style="color: #6c757d; margin: 10px 0 0 0;">Based on ${results.confidence.questionsAnswered} of ${results.confidence.totalQuestions} data points</p>
        </div>
        
        <div style="margin-top: 40px;">
          <button onclick="window.location.reload()" style="background: #2d5016; color: white; padding: 12px 30px; border: none; border-radius: 6px; cursor: pointer; font-size: 1rem; margin-right: 10px;">Start New Assessment</button>
          <button onclick="alert('PDF download coming soon!')" style="background: #ffc107; color: #1a1a1a; padding: 12px 30px; border: none; border-radius: 6px; cursor: pointer; font-size: 1rem;">Download PDF Report</button>
        </div>
      </div>
    </div>
  `;
  
  // Add to page
  document.body.insertAdjacentHTML('beforeend', resultsHTML);
  
  // Scroll to top
  window.scrollTo(0, 0);
}
